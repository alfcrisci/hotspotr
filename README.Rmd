[![Build Status](https://travis-ci.org/mpadge/hotspotr.svg?branch=master)](https://travis-ci.org/mpadge/hotspotr)
[![codecov](https://codecov.io/gh/mpadge/hotspotr/branch/master/graph/badge.svg)](https://codecov.io/gh/mpadge/hotspotr)

R package for estimating whether the statistical properties of a spatial pattern
of hotspots may be reproduced with a simple neutral model. Currently only works
for gridded data.

## Install

```{r, eval=FALSE}
devtools::install_github ('mpadge/hotspotr')
```
```{r load, echo=FALSE, message=FALSE}
while (length (grep ('hotspotr', getwd ())) > 0) setwd ("..")
#devtools::document ("hotspotr")
#devtools::check ("hotspotr")
devtools::load_all ("hotspotr")
setwd ("./hotspotr")
```

## Test

First a demonstration with a seed that produces a 2D field very similar to
neutral fields.

```{r demo, fig.width=12, fig.height=6}
plot.new ()
seed <- 18
ymat <- ives2d (size=10, seed=seed)
test <- test2d (ymat, plot=TRUE)
```

The default spatial autocorrelation statistic is Moran's I, with results for
other statistics in this case notably different. Geary's C:
```{r demo-geary, fig.width=12, fig.height=6}
plot.new ()
test <- test2d (ymat, plot=TRUE, actype='geary')
```

And Getis-Ord:
```{r demo-getis, fig.width=12, fig.height=6}
plot.new ()
test <- test2d (ymat, plot=TRUE, actype='getis')
```

Then the text output of `run_tests` for a random seed giving more typically low
p-values
```{r run_tests}
run_tests (size=10, ntests=1000)
```
`run_tests` can also be used to test a neutral field against a statistial
ensemble of neutral fields:
```{r run_tests_neutral}
run_tests (size=10, ntests=1000, neutral=TRUE)
```

This is a problem (from `test1d`):
```{r}
fn_n <- function (x)
{
    ytest <- neutral1d (size, alpha=alpha, nt=x)
    ytest <- (ytest - min (ytest)) / diff (range (ytest))
    ytest <- sort (ytest, decreasing=TRUE)
    sum ((ytest - ydat) ^ 2)
}
n <- 1:200
y <- sapply (n, function (i) fn_n (i))
plot (n, y, "l")
```
The function has no systematic behaviour at all! Try for `alpha`:
```{r}
fn_a <- function (x)
{
    ytest <- neutral1d (size, alpha=x, nt=nt)
    ytest <- (ytest - min (ytest)) / diff (range (ytest))
    ytest <- sort (ytest, decreasing=TRUE)
    sum ((ytest - ydat) ^ 2)
}
a <- 1:100 / 100
y <- sapply (a, function (i) fn_a (c (0.1, i)))
plot (a, y, "l")
y <- sapply (a, function (i) fn_a (c (i, 0.1)))
plot (a, y, "l")
```
These functions are total ill-behaved!
