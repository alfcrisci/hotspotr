[![Build Status](https://travis-ci.org/mpadge/hotspotr.svg?branch=master)](https://travis-ci.org/mpadge/hotspotr)
[![codecov](https://codecov.io/gh/mpadge/hotspotr/branch/master/graph/badge.svg)](https://codecov.io/gh/mpadge/hotspotr)

R package for estimating whether the statistical properties of a spatial pattern
of hotspots may be reproduced with a simple neutral model. Currently only works
for gridded data.

## Install

```{r, eval=FALSE}
devtools::install_github ('mpadge/hotspotr')
```
```{r load, echo=FALSE, message=FALSE}
while (length (grep ('hotspotr', getwd ())) > 0) setwd ("..")
#devtools::document ("hotspotr")
#devtools::check ("hotspotr")
devtools::load_all ("hotspotr")
setwd ("./hotspotr")
```

## Demonstration

Use the `meuse` data from the `sp` package, which contain topsoil heavy metal
concentrations near Meuse, NL.

```{r}
data (meuse, package='sp')
names (meuse)
```

The function `test_hotspots` requires data to be tested, a list of
neighbours (constructed here as `knearneigh`), and a matching list of weights
(constructed here as inverse-distance weights):
```{r}
xy <- cbind (meuse$x, meuse$y)
nbs <- spdep::knn2nb (spdep::knearneigh (xy, k=4))
dists <- spdep::nbdists (nbs, xy)
d1 <- lapply (dists, function (i) 1/i)
```{r, eval=FALSE}
test <- test_hotspots (z=meuse$cadmium, nbs=nbs, wts=d1, plot=TRUE)
test <- test_hotspots (z=meuse$copper, nbs=nbs, wts=d1, plot=TRUE)
test <- test_hotspots (z=meuse$lead, nbs=nbs, wts=d1, plot=TRUE)
test <- test_hotspots (z=meuse$zinc, nbs=nbs, wts=d1, plot=TRUE)
```
```{r, eval=FALSE, echo=FALSE}
test <- test_hotspots (z=meuse$cadmium, nbs=nbs, wts=d1, verbose=TRUE, plot=TRUE)
test <- test_hotspots (z=meuse$copper, nbs=nbs, wts=d1, verbose=TRUE, plot=TRUE)
test <- test_hotspots (z=meuse$lead, nbs=nbs, wts=d1, verbose=TRUE, plot=TRUE)
test <- test_hotspots (z=meuse$zinc, nbs=nbs, wts=d1, verbose=TRUE, plot=TRUE)
```

## Test

First a demonstration with a seed that produces a 2D field very similar to
neutral fields.

```{r demo-moran, fig.width=12, fig.height=6}
plot.new ()
seed <- 18
dat <- ives (size=10, seed=seed)
test <- test_hotspots (z=dat$dat$z, nbs=dat$nbs, verbose=TRUE, plot=TRUE)
```
```{r}
alpha <- c (0.1, 0.1)
dat <- ives (size=10, nt=100, sd0=0.1, alpha=alpha)
z <- neutral_hotspots (nbs=dat$nbs, alpha=alpha)
test <- p_values (z=z, nbs=dat$nbs, alpha=alpha, ntests=1000, plot=TRUE)
```

The default spatial autocorrelation statistic is Moran's I, with results for
other statistics in this case notably different. Geary's C:
```{r demo-geary, fig.width=12, fig.height=6}
plot.new ()
test <- test_hotspots (z=dat$z, nbs=dat$nbs, plot=TRUE, ac_type='geary')
```

And Getis-Ord:
```{r demo-getis, fig.width=12, fig.height=6}
plot.new ()
test <- test_hotspots (z=dat$z, nbs=dat$nbs, plot=TRUE, ac_type='getis')
```

Then the text output of `run_tests` for a random seed giving more typically low
p-values.
```{r run_tests}
dat <- ives (size=10)
run_tests (nbs=dat$nbs, z=dat$z, ntests=100)
```
Note that the model field tested here has a complex *temporal* structure yet a
generic---that is, neutral---*spatial structure, and that the `p-values` reflect
these differences.

`run_tests` can also be used to test a neutral field against a statistial
ensemble of neutral fields:
```{r run_tests_neutral}
run_tests (neutral=TRUE)
```
